name: Fabric - Get Git Credentials

on:
  workflow_dispatch:

jobs:
  get-git-credentials:
    runs-on: ubuntu-latest

    steps:
      - name: üì¶ Checkout code
        uses: actions/checkout@v4

      - name: üßë‚Äçüíª Azure login with device code (user identity)
        run: |
          az login --use-device-code

      - name: üîê Get Fabric access token
        id: fabric-auth
        run: |
          FABRIC_TOKEN=$(az account get-access-token \
            --resource=https://api.fabric.microsoft.com \
            --query accessToken -o tsv)
          echo "token=$FABRIC_TOKEN" >> $GITHUB_OUTPUT

      - name: üîç Get configured Git credentials
        env:
          FABRIC_TOKEN: ${{ steps.fabric-auth.outputs.token }}
          WORKSPACE_ID: ${{ secrets.DEV_WORKSPACE_ID }}
        run: |
          echo "üìÇ Checking Git credentials for workspace: $WORKSPACE_ID"

          curl -X GET "https://api.fabric.microsoft.com/v1/workspaces/$WORKSPACE_ID/git/myGitCredentials" \
            -H "Authorization: Bearer $FABRIC_TOKEN" \
            -H "Content-Type: application/json"
